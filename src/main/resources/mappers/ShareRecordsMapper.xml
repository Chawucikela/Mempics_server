<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.nowcoder.seckill.dao.ShareRecordsMapper">
	<resultMap id="BaseResultMap" type="com.nowcoder.seckill.entity.ShareRecords">
		<!--
		  WARNING - @mbg.generated
		  This element is automatically generated by MyBatis Generator, do not modify.
		  This element was generated on Fri Jul 02 00:41:53 CST 2021.
		-->
		<id column="id" jdbcType="VARCHAR" property="id"/>
		<result column="user_id" jdbcType="INTEGER" property="userId"/>
		<result column="title" jdbcType="VARCHAR" property="title"/>
		<result column="description" jdbcType="VARCHAR" property="description"/>
		<result column="share_time" jdbcType="TIMESTAMP" property="shareTime"/>
	</resultMap>
	<delete id="deleteByPrimaryKey" parameterType="java.lang.String">
		<!--
		  WARNING - @mbg.generated
		  This element is automatically generated by MyBatis Generator, do not modify.
		  This element was generated on Fri Jul 02 00:41:53 CST 2021.
		-->
		delete from share_records
		where id = #{id,jdbcType=VARCHAR}
	</delete>
	<insert id="insert" parameterType="com.nowcoder.seckill.entity.ShareRecords">
		<!--
		  WARNING - @mbg.generated
		  This element is automatically generated by MyBatis Generator, do not modify.
		  This element was generated on Fri Jul 02 00:41:53 CST 2021.
		-->
		insert into share_records (id, user_id, title,
		description, share_time)
		values (#{id,jdbcType=VARCHAR}, #{userId,jdbcType=INTEGER}, #{title,jdbcType=VARCHAR},
		#{description,jdbcType=VARCHAR}, #{shareTime,jdbcType=TIMESTAMP})
	</insert>
	<update id="updateByPrimaryKey" parameterType="com.nowcoder.seckill.entity.ShareRecords">
		<!--
		  WARNING - @mbg.generated
		  This element is automatically generated by MyBatis Generator, do not modify.
		  This element was generated on Fri Jul 02 00:41:53 CST 2021.
		-->
		update share_records
		set user_id = #{userId,jdbcType=INTEGER},
		title = #{title,jdbcType=VARCHAR},
		description = #{description,jdbcType=VARCHAR},
		share_time = #{shareTime,jdbcType=TIMESTAMP}
		where id = #{id,jdbcType=VARCHAR}
	</update>
	<select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
		<!--
		  WARNING - @mbg.generated
		  This element is automatically generated by MyBatis Generator, do not modify.
		  This element was generated on Fri Jul 02 00:41:53 CST 2021.
		-->
		select id, user_id, title, description, share_time
		from share_records
		where id = #{id,jdbcType=VARCHAR}
	</select>
	<select id="selectAll" resultMap="BaseResultMap">
		<!--
		  WARNING - @mbg.generated
		  This element is automatically generated by MyBatis Generator, do not modify.
		  This element was generated on Fri Jul 02 00:41:53 CST 2021.
		-->
		select id, user_id, title, description, share_time
		from share_records
	</select>
	
	
	<!-- ============================================================================ -->
	
	<resultMap id="ShareRecordSimplifiedMap"
	           type="com.nowcoder.seckill.entity.resultentity.ShareRecordSimplifiedResult">
		<id column="id" jdbcType="VARCHAR" property="id"/>
		<result column="user_id" jdbcType="INTEGER" property="userId"/>
		<result column="title" jdbcType="VARCHAR" property="title"/>
	</resultMap>
	
	<resultMap id="ShareRecordDetailedMap" type="com.nowcoder.seckill.entity.resultentity.ShareRecordDetailedResult">
		<id column="id" jdbcType="VARCHAR" property="id"/>
		<result column="user_id" jdbcType="INTEGER" property="userId"/>
		<result column="title" jdbcType="VARCHAR" property="title"/>
		<result column="description" jdbcType="VARCHAR" property="description"/>
		<result column="share_time" jdbcType="TIMESTAMP" property="shareTime"/>
	</resultMap>
	
	<select id="selectByPrimaryKeyDetailed" parameterType="java.lang.String" resultMap="ShareRecordDetailedMap">
		select id, user_id, title, description, share_time
		from share_records
		where id = #{id,jdbcType=INTEGER}
	</select>
	
	<select id="selectByUserIdSimplified" parameterType="java.lang.Integer" resultMap="ShareRecordSimplifiedMap">
		select id, user_id, title
		from share_records
		where user_id = #{userId,jdbcType=INTEGER}
		order by id DESC;
	</select>
	
	<select id="selectFriendsSRByUserIdSimplified" parameterType="java.lang.Integer"
	        resultMap="ShareRecordSimplifiedMap">
		select S.id, user_id, R1.nickname, title
		from share_records S
		inner join
		(select U.id, U.nickname, U.username, U.gender
		from relationship R
		inner join user_info U
		on R.following_user_id = U.id
		where user_id = #{userId,jdbcType=INTEGER}) R1
		on R1.id = user_id
		union
		select S.id, user_id, U.nickname, title
		from share_records S
		inner join user_info U
		on user_id = U.id
		where user_id = #{userId,jdbcType=INTEGER}
		order by id DESC;
	</select>
</mapper>